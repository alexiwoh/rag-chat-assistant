#!/bin/bash

echo "üßπ Cleaning up rag-chat-assistant..."

# Parse optional flags
REBUILD=false
for arg in "$@"; do
  if [[ "$arg" == "--rebuild" ]]; then
    REBUILD=true
  fi
done

# Delete Chroma vector database
CHROMA_DB_PATH="app/databases/chroma_db"
if [ -d "$CHROMA_DB_PATH" ]; then
    echo "üóë Removing vector store at $CHROMA_DB_PATH"
    rm -rf "$CHROMA_DB_PATH"
else
    echo "‚úÖ No Chroma DB found, skipping."
fi

# Delete Ollama model logs
if [ -f "ollama.log" ]; then
    echo "üóë Removing Ollama log"
    rm -f ollama.log
fi

# Stop and clean up Docker
echo "üõë Stopping and cleaning Docker environment..."
docker-compose down -v --remove-orphans

# Optional: force rebuild of Docker image
if [ "$REBUILD" = true ]; then
    echo "‚ôªÔ∏è Rebuilding Docker images without cache..."
    docker-compose build --no-cache
else
    echo "‚ÑπÔ∏è Skipping Docker rebuild. Use --rebuild to force it."
fi

echo "‚úÖ Cleanup complete."