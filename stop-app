#!/bin/bash

echo "üõë Stopping Docker containers..."
docker-compose down

echo "üõë Stopping all running Ollama models..."
if ollama list &> /dev/null; then
    ollama list | awk 'NR>1 {print $1}' | while read -r MODEL; do
        echo "üõë Stopping model: $MODEL"
        ollama stop "$MODEL" 2>/dev/null
    done
    echo "‚úÖ All Ollama models stopped."
else
    echo "‚ÑπÔ∏è No Ollama models to stop (none pulled yet)."
fi

echo "üõë Checking for background 'ollama serve' process..."
# Cross-platform: kill background processes started from the terminal
OLLAMA_PIDS=$(pgrep -f "ollama serve")

if [ -z "$OLLAMA_PIDS" ]; then
  echo "‚úÖ No terminal-launched Ollama processes found."
else
  for PID in $OLLAMA_PIDS; do
    echo "üõë Killing ollama serve (PID $PID)..."
    kill "$PID" 2>/dev/null
  done
  echo "‚úÖ Terminal-launched Ollama processes stopped."
fi

# Mac note
OS_TYPE="$(uname -s)"
if [[ "$OS_TYPE" == "Darwin" ]]; then
  echo "‚ÑπÔ∏è Ollama might still be running via the macOS menu bar."
  echo "üëâ To fully quit it, right-click the Ollama icon in your menu bar and select 'Quit Ollama'."
fi